<h4>FINAL EXAM</h4>

<%= link_to "Add Manually", edit_user_table_finaltable_path(@user, @table, @table), class: "bg-blue mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" if user_signed_in? and @user.id == current_user.id %><br>
<%= raw('<small><i class="glyphicon glyphicon-exclamation-sign"></i> MANUALLY IS THE MOST IMPORTANT </small>') if user_signed_in? and @user.id == current_user.id %>

<div class="table-responsive">
    <span class="table-respon-hint"> <-- Use scroll bar--> </span>
    <table class="table-finalexam table table-striped table-crop table-hover mdl-shadow--3dp"> 
        <caption>
            FINAL TABLE
            <span class="pull-right"> 
                <i class="text-manual glyphicon glyphicon-stop"></i> MANUALLY
                <i class="text-final glyphicon glyphicon-stop"></i> FINAL TABLE
                <i class="text-regular glyphicon glyphicon-stop"></i> REGULAR EXAM
            </span>
        </caption>
        <tr>
            <td>DAY</td>
            <td>08:00 - 11:00</td>
            <td>12:00 - 15:00</td>
            <td>15:30 - 18:30</td>
        </tr>
        <% @myexam.each_with_index do |a, index| %>
            <% if @count == 0 %> 
                <tr> 
                <td class="finalexam-td"><%= a[0] %>
            <% end %>
            <td>
                <% @classes.each do |class_| %>
                    <!-- manual -->
                    <% if class_.dayFinal.to_s.downcase == a[0].gsub(' ', '').to_s.downcase %>
                        <% if (class_.timeFinal.to_s[0..5].gsub(/[\s:-]/, '') == '0800' and @count == 0) or
                              (class_.timeFinal.to_s[0..5].gsub(/[\s:-]/, '') == '1200' and @count == 1) or
                              (class_.timeFinal.to_s[0..5].gsub(/[\s:-]/, '') == '1530' and @count == 2) %>
                                <span class="text-manual"><%= class_.subject %><br></span>
                                <% @is_shown.add(class_.subject_code) %>
                        <% end %>   
                    <% end %>
                    

                    <!-- final table -->
                    <% if not @is_shown_manual.include? class_.subject_code and 
                          not @is_shown.include? class_.subject_code and 
                          a[1].include? class_.subject_code %>

                         <span class="text-final"><%= class_.subject %></span>
                         <% @is_shown.add(class_.subject_code) %>
                         <br>
                    <% end %>

        
                    <!-- regular exam -->
                    <% @regular.each do |regular| %>
                        <% if not @exam_selected.text.include? class_.subject_code and regular.dateexam.split(' ')[1..2].join('') == a[0].gsub(' ', '') %> <!-- check day -->
                            <% if (regular.dateexam.split(' ')[3][0..1] == '08' and @count == 0) or
                                  (regular.dateexam.split(' ')[3][0..1] == '12' and @count == 1) or
                                  (regular.dateexam.split(' ')[3][0..1] == '15' and @count == 2) %>

                                <% if not @is_shown.include? class_.subject_code and class_.daily == regular.dayexam and class_.start == regular.timeexam %>
                                    <span class="text-regular"><%= class_.subject %><br></span>
                                    <% @is_shown.add(class_.subject_code) %>
                                    <% @is_shown_regular.add(class_.subject_code) %>
                                <% end %>           
                            <% end %>   
                        <% end %>   
                    <% end %>
                <% end %>
            </td>
            <% @count += 1 %>
            <% @count = 0 if @count == 3 %>
            <% if @count == 0 %> </tr> <% end %>
        <% end %>
    </table>
</div>

<div class="table-responsive">
    <table class="table table-striped table-crop table-hover mdl-shadow--3dp"> 
        <caption>FINAL EXAM (day and time besides a top table)</caption>
        <thead>
            <tr>
                <th class="text-center">Subject code</th>
                <th class="text-center">Subject</th>
                <th class="text-center">Day</th>
                <th class="text-center">Time</th>
            </tr>
        </thead>
        <tbody>
            <% is_besides = true %>
            <% @classes.each do |class_| %>
                <% if not @is_shown.include? class_.subject_code and @is_shown_manual.include? class_.subject_code %>
                    <tr>    
                        <td><%= class_.subject_code%></td>
                        <td><%= class_.subject%></td>
                        <td><%= class_.dayFinal%></td>
                        <td><%= class_.timeFinal%></td>
                        <% is_besides = false %>
                    </tr>
                    <% @is_shown.add(class_.subject_code) %>
                <% end %>
            <% end %>
            
            <%= raw("<tr><td colspan='4'>NO DATA</td></tr>") if is_besides %>
            
        </tbody>
    </table> 
</div>

<%= link_to "BACK", user_table_classtables_path, id: @table, class: "bg-red mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" %>



