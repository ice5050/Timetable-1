<h2>Timetable</h2>

<p class="text-left">
    Timtable name: <%= @table.name %>
    <%= link_to "back", user_tables_path, class: "bg-red mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" if user_signed_in? %>
    <%= link_to "back", homepages_path, class: "bg-red mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" if !user_signed_in? %>
</p>

<% if $error.length != 0 %>
    <%= $error %>
    <% $error = "" %>
<% end %>

<% if user_signed_in? and @user.id == current_user.id %>
    <%= form_for :class, url: user_table_classtables_path(current_user, @table) do |f| %>
        <div class="add-class  mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.label :subject_code, class: "mdl-textfield__label" %>
            <%= f.text_field :subject_code, class: "mdl-textfield__input" %>
        </div>
        <div class="add-class  mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.label :subject, class: "mdl-textfield__label" %>
            <%= f.text_field :subject, class: "mdl-textfield__input" %>
        </div>
        <div class="add-class  mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.label :room, class: "mdl-textfield__label" %>
            <%= f.text_field :room, class: "mdl-textfield__input" %>
        </div>
        <div class="add-class  mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <%= f.label :section, class: "mdl-textfield__label" %>
            <%= f.text_field :section, class: "mdl-textfield__input" %>
        </div>

        <%= f.label :day %>
        <%= f.select :daily, (options_for_select([['Sunday', 1], ['Monday', 2], ['Tuesday', 3], ['Wednesday', 4], ['Thursday', 5], ['Friday', 6], ['Saturday', 7]])) %>

        <%= f.label :start %>
        <%= f.select :start, (options_for_select([['0800', 1], ['0830', 2], ['0900', 3], ['0930', 4], ['1000', 5], ['1030', 6], ['1100', 7], ['1130', 8], ['1200', 9], ['1230', 10], ['1300', 11], ['1330', 12], ['1400', 13], ['1430', 14], ['1500', 15], ['1530', 16], ['1600', 17], ['1630', 18], ['1700', 19], ['1730', 20], ['1800', 21], ['1830', 22], ['1900', 23], ['1930', 24], ['2000', 25], ])) %>


        <%= f.label :finish %>
        <%= f.select :finish, (options_for_select([['0830', 2], ['0900', 3], ['0930', 4], ['1000', 5], ['1030', 6], ['1100', 7], ['1130', 8], ['1200', 9], ['1230', 10], ['1300', 11], ['1330', 12], ['1400', 13], ['1430', 14], ['1500', 15], ['1530', 16], ['1600', 17], ['1630', 18], ['1700', 19], ['1730', 20], ['1800', 21], ['1830', 22], ['1900', 23], ['1930', 24], ['2000', 25]])) %>
        
        <%= f.submit "SAVE", class: "bg-green mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" %>

    <% end %>
<% end %>

<div class="pure-g text-center">    
    <div class="pure-u-2-24 bg-midnight">CMU</div>
    <% (8..18).each do |i| %>
        <div class="pure-u-2-24 bg-midnight">
            <%= sprintf '%02d', i %>
        </div>
    <% end %>
</div>
<div class="pure-g text-center">    
    <div class="pure-u-2-24 bg-midnight">Timtable</div>
    <% (1..22).each do |i| %>
        <div class="pure-u-1-24 bg-midnight">
            <%= 00 if i % 2 == 1 %>
            <%= 30 if i % 2 == 0 %>
        </div>
    <% end %>
</div>


<% @days.each do |day| %>
    <div class="pure-g text-center">    
    <div class="pure-u-2-24 bg-midnight">
        <p class="text-center"><%= day.day %></p>
    </div>
        <% @classes.each do |class_| %> 
            <% while @i <= 22 and class_.daily == day.id do %>
                <% if class_.start == @i %>
                    <div class="text-crop bg-green pure-u-<%= Timer.find(class_.finish).id - Timer.find(class_.start).id %>-24">
                        <p class="text-center">
                            <%= class_.subject_code %> |
                            <%= class_.subject %> |
                            <%= class_.room %> |
                            <%= class_.section %>
                        
                            <%= link_to raw("<i class='glyphicon glyphicon-remove-sign'></i>"), user_table_classtable_path(current_user, @table, class_), method: :delete, data: { confirm: "OK?" } if user_signed_in? and @user.id == current_user.id %>
                        </p>
                    </div>                    
                    <% @i += Timer.find(class_.finish).id - Timer.find(class_.start).id %>
                    <% break %>
                <% else %>
                    <%= raw('<div class="bg-white pure-u-1-24">') if day.id % 2 == 1 %>
                    <%= raw('<div class="bg-silver pure-u-1-24">') if day.id % 2 == 0 %>
                        <% @i += 1 %>
                    </div>
                <% end %>
            <% end %>
        <% end %>

        <% while @i <= 22 do %>
            <%= raw('<div class="bg-white pure-u-1-24">') if day.id % 2 == 1 %>
            <%= raw('<div class="bg-silver pure-u-1-24">') if day.id % 2 == 0 %>
                <% @i += 1 %>
            </div>
        <% end %>
    </div>
    <% @i = 1 %>
<% end %><br>

<table class="table">
    <tr>
        <td>Subject code</td>
        <td>Subject</td>
        <td>Day</td>
        <td>Start</td>
        <td>Finish</td>
    </tr>
    <% @classes.each do |class_| %>
    <tr>
        <td><%= class_.subject_code %></td>
        <td><%= class_.subject %></td>
        <td><%= class_.daily %> > <%= Day.find(class_.daily).day %></td>
        <td><%= class_.start %> > <%= Timer.find(class_.start).time %></td>
        <td><%= class_.finish %> > <%= Timer.find(class_.finish).time %></td>
    </tr>
    <% end %>
</table>